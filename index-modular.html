<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xpress.Delivery - Zam√≥w przesy≈Çkƒô</title>
    
    <!-- Modular CSS -->
    <link rel="stylesheet" href="src/styles/base.css">
    <link rel="stylesheet" href="src/styles/components.css">
    <link rel="stylesheet" href="src/styles/responsive.css">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,400;0,700;1,700&family=Roboto:wght@100;400;700&display=swap" rel="stylesheet">

    <!-- Leaflet.js for maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body>
    <!-- Animated Arrow Background -->
    <canvas id="arrow-background" style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: -1; opacity: 0.08;"></canvas>

    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>Xpress.<span class="highlight">Delivery</span></h1>
            <p>Wy≈õlij swojƒÖ przesy≈Çkƒô ekspresowƒÖ w 3 prostych krokach!</p>
        </header>

        <!-- Main Form Page -->
        <div id="main-page" class="page active">
            <main class="main-content">
                <!-- Address Input -->
                <section class="address-section">
                    <div class="address-inputs">
                        <div class="address-group">
                            <label>‚Üí SkƒÖd odbieramy?</label>
                            <input type="text" id="pickup-address" placeholder="ul. Krakowska 123, Warszawa" />
                        </div>
                        <div class="address-group">
                            <label>‚Üí Gdzie dostarczamy?</label>
                            <input type="text" id="delivery-address" placeholder="ul. Marsza≈Çkowska 45, Warszawa" />
                        </div>
                    </div>
                </section>

                <!-- Results Section (hidden initially) -->
                <section id="results-section" class="results-section" style="display: none;">
                    <!-- Route Map -->
                    <div id="route-map-container" style="display: none; margin: 0 0 2rem 0;">
                        <h3 style="margin-bottom: 1rem;">‚Üí Trasa przejazdu</h3>
                        <div id="route-map" style="width: 100%; height: 400px; border-radius: 16px; border: 1px solid rgba(255, 255, 255, 0.1);"></div>
                    </div>

                    <!-- Quick Route Info -->
                    <div class="route-summary">
                        <div class="route-visual">
                            <span class="point">A</span>
                            <div class="route-line"></div>
                            <span class="point">B</span>
                        </div>
                        <div class="route-details">
                            <strong id="distance-display">7.2 km</strong> ‚Ä¢ <strong id="time-display">25 min</strong>
                        </div>
                    </div>

                    <!-- Package Options with Instant Pricing -->
                    <div class="package-pricing">
                        <h3>Wybierz wielko≈õƒá i zam√≥w</h3>
                        <div class="package-options">
                            <div class="package-option" data-size="small">
                                <div class="package-info">
                                    <div class="package-icon">‚Üí</div>
                                    <div class="package-details">
                                        <h4>Ma≈Ça</h4>
                                        <p>Do 2kg, dokumenty</p>
                                    </div>
                                </div>
                                <div class="package-price">
                                    <div class="price" id="price-small">24.50 z≈Ç</div>
                                    <div class="order-btn">Zamawiam</div>
                                </div>
                            </div>

                            <div class="package-option" data-size="medium">
                                <div class="package-info">
                                    <div class="package-icon">‚Üí</div>
                                    <div class="package-details">
                                        <h4>≈örednia</h4>
                                        <p>Do 10kg, paczki</p>
                                    </div>
                                </div>
                                <div class="package-price">
                                    <div class="price" id="price-medium">32.80 z≈Ç</div>
                                    <div class="order-btn">Zamawiam</div>
                                </div>
                            </div>

                            <div class="package-option" data-size="large">
                                <div class="package-info">
                                    <div class="package-icon">‚Üí</div>
                                    <div class="package-details">
                                        <h4>Du≈ºa</h4>
                                        <p>Do 30kg, wiƒôksze</p>
                                    </div>
                                </div>
                                <div class="package-price">
                                    <div class="price" id="price-large">48.20 z≈Ç</div>
                                    <div class="order-btn">Zamawiam</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Order Details Form (hidden initially) -->
                <section id="order-form-section" class="order-form-section" style="display: none;">
                    <div class="order-header">
                        <h3>Finalizuj zam√≥wienie</h3>
                        <div class="order-summary">
                            <span id="summary-package">Ma≈Ça paczka</span> ‚Ä¢ 
                            <span id="summary-route">Krakowska ‚Üí Marsza≈Çkowska</span> ‚Ä¢ 
                            <strong id="summary-price">24.50 z≈Ç</strong>
                        </div>
                    </div>

                    <form id="contact-form">
                        <div class="contact-sections">
                            <div class="contact-section">
                                <h4>üë§ Dane nadawcy</h4>
                                <div class="form-row">
                                    <input type="text" name="senderName" placeholder="Imiƒô i nazwisko" required autocomplete="name" />
                                    <input type="tel" name="senderPhone" placeholder="+48 123 456 789" required pattern="(\+48\s?)?(\d{3}\s?\d{3}\s?\d{3}|\d{2}\s?\d{3}\s?\d{2}\s?\d{2})" title="Format: +48 XXX XXX XXX lub XXX XXX XXX" autocomplete="tel" />
                                </div>
                                <input type="email" name="senderEmail" placeholder="jan@example.com" required autocomplete="email" />
                            </div>

                            <div class="contact-section">
                                <h4>üë• Dane odbiorcy</h4>
                                <div class="form-row">
                                    <input type="text" name="recipientName" placeholder="Imiƒô i nazwisko" required autocomplete="shipping name" />
                                    <input type="tel" name="recipientPhone" placeholder="+48 123 456 789" required pattern="(\+48\s?)?(\d{3}\s?\d{3}\s?\d{3}|\d{2}\s?\d{3}\s?\d{2}\s?\d{2})" title="Format: +48 XXX XXX XXX lub XXX XXX XXX" autocomplete="shipping tel" />
                                </div>
                                <input type="email" name="recipientEmail" placeholder="jan@example.com" required autocomplete="shipping email" />
                            </div>
                        </div>

                        <!-- Payment -->
                        <div class="payment-section">
                            <div class="payment-summary">
                                <span>Do zap≈Çaty: <strong id="final-price">24.50 z≈Ç</strong></span>
                            </div>
                            <div class="payment-methods">
                                <span>üí≥ Karta</span>
                                <span>üì± BLIK</span>
                                <span>üè™ Revolut</span>
                            </div>
                            <button type="submit" class="btn-pay">
                                üí≥ Zap≈Çaƒá i zam√≥w <span id="pay-price">24.50 z≈Ç</span>
                            </button>
                        </div>
                    </form>
                </section>
            </main>
        </div>

        <!-- Thank You Page -->
        <div id="thank-you-page" class="page">
            <div class="thank-you-content">
                <div class="success-icon">‚úÖ</div>
                <h1>Zam√≥wione!</h1>
                <p class="success-subtitle">Twoja przesy≈Çka jest ju≈º w drodze</p>

                <div class="order-details">
                    <h3>Szczeg√≥≈Çy zam√≥wienia</h3>
                    <div class="order-number">
                        <strong id="final-order-number">XPR-2024-001234</strong>
                    </div>
                    
                    <div class="detail-row">
                        <span class="label">Trasa:</span>
                        <span id="final-route">Krakowska ‚Üí Marsza≈Çkowska</span>
                    </div>
                    <div class="detail-row">
                        <span class="label">Wielko≈õƒá:</span>
                        <span id="final-package">Ma≈Ça paczka</span>
                    </div>
                    <div class="detail-row">
                        <span class="label">Koszt:</span>
                        <strong id="final-cost">24.50 z≈Ç</strong>
                    </div>
                    <div class="detail-row">
                        <span class="label">Czas dostawy:</span>
                        <span id="final-time">25-35 min</span>
                    </div>
                </div>

                <div class="next-steps">
                    <h3>Co dalej?</h3>
                    <div class="steps">
                        <div class="step-item">
                            <span class="step-time">Za 2 min</span>
                            <span>üìß Potwierdzenie na email</span>
                        </div>
                        <div class="step-item">
                            <span class="step-time">Za 5-10 min</span>
                            <span>üì± SMS z danymi kuriera</span>
                        </div>
                        <div class="step-item">
                            <span class="step-time">Za 30-45 min</span>
                            <span>üöö Kurier odbierze paczkƒô</span>
                        </div>
                    </div>
                </div>

                <div class="help-section">
                    <p>üìû Potrzebujesz pomocy? <strong>+48 800 123 456</strong></p>
                </div>

                <button class="btn-new-order btn btn-primary">
                    üöÄ Zam√≥w kolejnƒÖ przesy≈Çkƒô
                </button>
            </div>
        </div>

        <!-- Loading Overlay -->
        <div id="loading-overlay" class="loading-overlay">
            <div class="loading-content">
                <div class="spinner"></div>
                <p id="loading-text">Obliczam cenƒô...</p>
            </div>
        </div>
    </div>

    <!-- Chat Widget -->
    <div id="chat-widget" class="chat-widget">
        <button id="chat-toggle" class="chat-toggle" aria-label="Open chat">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
            </svg>
        </button>
        <div id="chat-modal" class="chat-modal" style="display: none;">
            <div class="chat-header">
                <h3>Xpress Assistant</h3>
                <button id="chat-close" aria-label="Close chat">√ó</button>
            </div>
            <div id="chat-messages" class="chat-messages"></div>
            <div class="chat-input-wrapper">
                <input id="chat-input" type="text" placeholder="Wpisz wiadomo≈õƒá..." />
                <button id="chat-send" aria-label="Send message">‚Üí</button>
            </div>
        </div>
    </div>

    <!-- Initialize Google Maps callback first -->
    <script>
        // Global callback function must exist before Google Maps loads
        window.initGoogleMaps = function() {
            console.log('üó∫Ô∏è Google Maps API loaded - waiting for app...');
            // Set flag that Google Maps is ready
            window.googleMapsReady = true;
            // Try to initialize if app is already loaded
            if (window.xpressApp && window.xpressApp.googleMapsService) {
                console.log('‚úÖ App ready - initializing autocomplete immediately');
                window.xpressApp.googleMapsService.initializeAutocomplete();
            }
        };
    </script>

    <!-- Load config first (with placeholders) -->
    <script src="config.local.js"></script>

    <!-- Dynamically inject Google Maps with API key from config -->
    <script>
        (function() {
            const apiKey = window.CONFIG_LOCAL?.googleMaps?.apiKey || '';
            if (!apiKey || apiKey.startsWith('__')) {
                console.error('‚ùå Google Maps API key not configured!');
                return;
            }
            const script = document.createElement('script');
            script.src = `https://maps.googleapis.com/maps/api/js?key=${apiKey}&libraries=places&callback=initGoogleMaps&loading=async`;
            script.async = true;
            script.defer = true;
            document.head.appendChild(script);
        })();
    </script>
    
    <!-- Modular JavaScript (ES6 Modules) -->
    <script type="module" src="src/components/XpressApp.js"></script>
</body>
</html>